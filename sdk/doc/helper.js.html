<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: helper.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: helper.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* 
* 
* Copyright (c) 2012-2014 Adobe Systems Incorporated. All rights reserved.

* Permission is hereby granted, free of charge, to any person obtaining a
* copy of this software and associated documentation files (the "Software"), 
* to deal in the Software without restriction, including without limitation 
* the rights to use, copy, modify, merge, publish, distribute, sublicense, 
* and/or sell copies of the Software, and to permit persons to whom the 
* Software is furnished to do so, subject to the following conditions:
* 
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
* 
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER 
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING 
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER 
* DEALINGS IN THE SOFTWARE.
* 
*/
(function($) {

    /**
     * Contains various utility or configuration functions.
     *
     * @namespace BCAPI.Helper
     */
    BCAPI.Helper = {};

	/**
     * Site configuration functions.
     * Override with your own version if needed.
     *
	 * @namespace BCAPI.Helper.Site
	 */
    BCAPI.Helper.Site =  {};

    /**
     * MicroEvent class provides and event emitter minimalist implementation which can be
     * used to add on / off / trigger methods to existing classes and literal objects.
     *
     * @public
     * @constructor
     * @memberof BCAPI.Helper
     */
    BCAPI.Helper.MicroEvent = function() { };

    BCAPI.Helper.MicroEvent.prototype = {
        /**
         * This method registers a callback function which is going to be invoked once the specified event is triggered.
         * 
         * @public
         * @method
         * @param  {String} event the event name on which the given callback will be invoked.
         * @param  {Function} fct The callback function which is going to be executed once the event will be triggered.
         */
        on: function(event, fct) {
            this._events = this._events || {};
            this._events[event] = this._events[event]   || [];
            this._events[event].push(fct);
        },
        
        /**
         * This method is used in order to unregister the specified function from being executed once the given event is triggered.
         * @param  {String} event The event name from which we want to unregister the callback.
         * @param  {Function} fct The function we want to unregister from event.
         */
        off: function(event, fct) {
            this._events = this._events || {};
            if( event in this._events === false  )  return;
            this._events[event].splice(this._events[event].indexOf(fct), 1);
        },

        /**
         * This method is used in order to trigger an event with a variable set of arguments.
         * @param  {String} event the event name we want to trigger.
         */
        trigger: function(event) {
            this._events = this._events || {};
            if( event in this._events === false  )  return;
            for(var i = 0; i &lt; this._events[event].length; i++){
                this._events[event][i].apply(this, Array.prototype.slice.call(arguments, 1));
            }
        }
    };

    /**
     * mixin will delegate all MicroEvent.js function in the destination object
     *
     * - require('MicroEvent').mixin(Foobar) will make Foobar able to use MicroEvent
     *
     * @param {Object} the object which will support MicroEvent
    */
    BCAPI.Helper.MicroEvent.mixin    = function(destObject){
        var props   = ['on', 'off', 'trigger'];
        for(var i = 0; i &lt; props.length; i ++){
            if( typeof destObject === 'function' ){
                destObject.prototype[props[i]]  = MicroEvent.prototype[props[i]];
            } else{
                destObject[props[i]] = BCAPI.Helper.MicroEvent.prototype[props[i]];
            }
        }
        
        return destObject;
    };


    /**
     * Returns the access_token from either the URL fragment or a session cookie (if it was read from URL and set before in cookie for short term reference)
     * 
     * @returns {string} The access_token
     */
    BCAPI.Helper.Site.getAccessToken = function() {        
        if (!$.cookie) {
            return $.error('Include jQuery.cookie or override BCAPI.Helper.Site.getAccessToken with your own implementation.');
        }

        var location = BCAPI.Helper.Http.getCurrentLocation();
        var parameters = BCAPI.Helper.Http.getHashFragments(location);
        var paramAccessToken = parameters['access_token'];
        var expiresIn = parseInt(parameters['expires_in'] || 
        									      "" + BCAPI.Config.ACCESS_TOKEN_DEFAULT_EXPIRATION);
        
        if (paramAccessToken){
            var expiryDate = new Date(Date.now());

            expiryDate.setTime(expiryDate.getTime() + expiresIn * 1000);
            
            var cookieOptions = {
            		"expires": expiryDate,
            		"path": "/",
            		"secure": true
            };
            $.cookie('access_token', paramAccessToken, cookieOptions);           
        }

        return paramAccessToken || $.cookie('access_token');
	};

    /**
     * This method obtains secure url required for API calls. It uses the current host from location
     * in order to detect prefix of APIs url. We can do this because BC api js sdk is always used 
     * with 3rd party applications served from a separated domain. 
     * 
     * @returns {string} API secure url.
     */
    BCAPI.Helper.Site.getRootUrl = function(wnd) {
    	wnd = wnd || window;
    	
        var url = [wnd.location.protocol, "//", wnd.location.hostname].join("");
        
        return url;
    };

    /**
     * @returns {string}
     */
    BCAPI.Helper.Site.getSiteId = function() {
        return 'current';
    };

    /**
     * Http utility functions.
     * Override with your own version if needed.
     *
     * @namespace BCAPI.Helper.Http
     */
    BCAPI.Helper.Http =  {};

    /**
     * Utility function to parse and decode parameters from a search or hash location part
     * 
     * @returns {object}
     * @example
     * // returns an object with key value pairs for each parameter (parameterName: parameterValue)
     * result = BCAPI.Helper.Http.getDecodedParameters("access_token=febf7b6a027b49239331cb6fa144&amp;token_type=example")
     * // result = {"access_token": "febf7b6a027b49239331cb6fa144", "token_type": "example"}
     */
    BCAPI.Helper.Http.getDecodedParameters = function(paramString) {
        var params = paramString.split('&amp;'),
        		decodedParams = {};
        
        if (params === "") { 
        	return {}; 
        }
        
	    for (var i = 0; i &lt; params.length; i += 1) {            
	        var param = params[i],
	            	firstEqual = param.indexOf("=");
	        
	        p = [];
	        
	        if(firstEqual > -1) {
	         	p.push(param.substr(0, firstEqual));
	            p.push(param.substr(firstEqual + 1));
	        }
	        
	        if (p.length === 2) {
	            decodedParams[p[0]] = decodeURIComponent(p[1].replace(/\+/g, " "));
	        }
	    }
	    
	    return decodedParams;
    };

    /**
     * Utility function to get the decoded query parameters from the location passed
     * 
     * @param {string} location Location object (e.g. the current location of the document)
     * @returns {object} An object with key value pairs for each query parameter with value
     * @example
     * result = BCAPI.Helper.Http.getQueryParameters("http://myexample.com?param1=value1&amp;param2=value2")
     * // result = {"param1": "value1", "param2": "value2"}
     */
    BCAPI.Helper.Http.getQueryParameters = function(location) {
        if (typeof location.search == undefined || location.search.length == 0){
            return {};
        }
        return BCAPI.Helper.Http.getDecodedParameters(location.search.substr(1));
    };

     /**
     * Utility function to get the decoded hash parameters from the location passed
     * 
     * @param {string} location Location object (e.g. the current location of the document)
     * @returns {object} An object with key value pairs for each hash parameter with value
     * @example
     * result = BCAPI.Helper.Http.getHashFragments("http://myexample.com#param1=value1&amp;param2=value2")
     * // result = {"param1": "value1", "param2": "value2"}
     */
    BCAPI.Helper.Http.getHashFragments = function(location) {
        if (typeof location.hash == undefined || location.hash.length == 0){
            return {};
        }
        return BCAPI.Helper.Http.getDecodedParameters(location.hash.substr(1));
    };

    /**
     * Helper function to isolate getting actual location, for unit testing
     * @returns {string}
     */
    BCAPI.Helper.Http.getCurrentLocation = function() {
        return window.location;
    };

})(jQuery);
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BCAPI.Components.Button.html">Button</a></li><li><a href="BCAPI.Components.Component.html">Component</a></li><li><a href="BCAPI.Components.DataGrid.html">DataGrid</a></li><li><a href="BCAPI.Components.DropDown.html">DropDown</a></li><li><a href="BCAPI.Components.TextField.html">TextField</a></li><li><a href="BCAPI.Models.Category.html">Category</a></li><li><a href="BCAPI.Models.CategoryCollection.html">CategoryCollection</a></li><li><a href="BCAPI.Models.Collection.html">Collection</a></li><li><a href="BCAPI.Models.Country.html">Country</a></li><li><a href="BCAPI.Models.CountryCollection.html">CountryCollection</a></li><li><a href="BCAPI.Models.FileSystem.File.html">File</a></li><li><a href="BCAPI.Models.FileSystem.Folder.html">Folder</a></li><li><a href="BCAPI.Models.Model.html">Model</a></li><li><a href="BCAPI.Models.WebApp.AppCollection.html">AppCollection</a></li><li><a href="BCAPI.Models.WebApp.Country.html">Country</a></li><li><a href="BCAPI.Models.WebApp.CustomField.html">CustomField</a></li><li><a href="BCAPI.Models.WebApp.CustomFieldCollection.html">CustomFieldCollection</a></li><li><a href="BCAPI.Models.WebApp.Item.html">Item</a></li><li><a href="BCAPI.Models.WebApp.ItemCategory.html">ItemCategory</a></li><li><a href="BCAPI.Models.WebApp.ItemCollection.html">ItemCollection</a></li></ul><h3>Namespaces</h3><ul><li><a href="BCAPI.html">BCAPI</a></li><li><a href="BCAPI.Components.html">Components</a></li><li><a href="BCAPI.Components.DataSources.html">DataSources</a></li><li><a href="BCAPI.Components.Validation.html">Validation</a></li><li><a href="BCAPI.Config.html">Config</a></li><li><a href="BCAPI.Config.Pagination.html">Pagination</a></li><li><a href="BCAPI.Helper.html">Helper</a></li><li><a href="BCAPI.Helper.Http.html">Http</a></li><li><a href="BCAPI.Helper.Site.html">Site</a></li><li><a href="BCAPI.Messaging.html">Messaging</a></li><li><a href="BCAPI.Models.html">Models</a></li><li><a href="BCAPI.Models.FileSystem.html">FileSystem</a></li><li><a href="BCAPI.Models.WebApp.html">WebApp</a></li><li><a href="BCAPI.Security.html">Security</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-legacy-apis.html">List of legacy apis</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0-dev</a> on Fri Aug 14 2015 13:35:58 GMT+0300 (EEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
