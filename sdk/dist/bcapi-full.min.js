!function($){"use strict";$.ajaxSetup({cache:!1}),$.cookie.raw=!0,window.BCAPI={}}(jQuery),function($){BCAPI.Helper={},BCAPI.Helper.Site={},BCAPI.Helper.Site.getAccessToken=function(){if(!$.cookie)return $.error("Include jQuery.cookie or override BCAPI.Helper.Site.getAccessToken with your own implementation.");var location=BCAPI.Helper.Http.getCurrentLocation(),parameters=BCAPI.Helper.Http.getHashFragments(location),paramAccessToken=parameters.access_token,expiresIn=parseInt(parameters.expires_in||String(BCAPI.Config.ACCESS_TOKEN_DEFAULT_EXPIRATION),10);if(paramAccessToken){var expiryDate=new Date(Date.now());expiryDate.setTime(expiryDate.getTime()+1e3*expiresIn);var cookieOptions={expires:expiryDate,path:"/",secure:!0};$.cookie("access_token",paramAccessToken,cookieOptions)}return paramAccessToken||$.cookie("access_token")},BCAPI.Helper.Site.getRootUrl=function(wnd){wnd=wnd||window;var url=[wnd.location.protocol,"//",wnd.location.hostname].join("");return url},BCAPI.Helper.Site.getSiteId=function(){return"current"},BCAPI.Helper.Http={},BCAPI.Helper.Http.getDecodedParameters=function(paramString){var params=paramString.split("&"),decodedParams={};if(""===params)return{};for(var i=0;i<params.length;i+=1){var param=params[i],firstEqual=param.indexOf("=");p=[],firstEqual>-1&&(p.push(param.substr(0,firstEqual)),p.push(param.substr(firstEqual+1))),2===p.length&&(decodedParams[p[0]]=decodeURIComponent(p[1].replace(/\+/g," ")))}return decodedParams},BCAPI.Helper.Http.getQueryParameters=function(location){return void 0===typeof location.search||0===location.search.length?{}:BCAPI.Helper.Http.getDecodedParameters(location.search.substr(1))},BCAPI.Helper.Http.getHashFragments=function(location){return void 0===typeof location.hash||0===location.hash.length?{}:BCAPI.Helper.Http.getDecodedParameters(location.hash.substr(1))},BCAPI.Helper.Http.getCurrentLocation=function(){return window.location}}(jQuery),BCAPI.Helper.MicroEvent=function(){function MicroEvent(){}return MicroEvent.prototype={on:function(event,fct){this._events=this._events||{},this._events[event]=this._events[event]||[],this._events[event].push(fct)},off:function(event,fct){this._events=this._events||{},event in this._events!=!1&&this._events[event].splice(this._events[event].indexOf(fct),1)},trigger:function(event){if(this._events=this._events||{},event in this._events!=!1)for(var i=0;i<this._events[event].length;i++)this._events[event][i].apply(this,Array.prototype.slice.call(arguments,1))}},MicroEvent.mixin=function(destObject){for(var props=["on","off","trigger"],i=0;i<props.length;i++)"function"==typeof destObject?destObject.prototype[props[i]]=MicroEvent.prototype[props[i]]:destObject[props[i]]=BCAPI.Helper.MicroEvent.prototype[props[i]];return destObject},MicroEvent}(),function($){var Config={};Config.Pagination={limit:10,skip:0},Config.MAX_DATE="9999-01-01",Config.ACCESS_TOKEN_DEFAULT_EXPIRATION=14400,BCAPI.Config=Config}(jQuery),function($){BCAPI.Models={},BCAPI.Models.Model=Backbone.Model.extend({endpoint:function(){throw new Error("You must provide an endpoint for your model. E.g: /api/v2/persons")},headers:function(){return{Authorization:BCAPI.Helper.Site.getAccessToken()}},urlRoot:function(modelEndpoint){var url=BCAPI.Helper.Site.getRootUrl();return modelEndpoint=modelEndpoint||this.endpoint(),"/"!==modelEndpoint.charAt(0)&&(modelEndpoint="/"+modelEndpoint),url+modelEndpoint},save:function(options){return options=options||{},options.dataType="text",Backbone.Model.prototype.save.call(this,this.attributes,options)},destroy:function(options){return options||(options={}),options.dataType="text",Backbone.Model.prototype.destroy.call(this,options)},sync:function(method,model,options){var customHeaders=this.headers();options.headers=options.headers||{};for(var headerKey in customHeaders)options.headers[headerKey]=customHeaders[headerKey];var xhr=Backbone.Model.prototype.sync.call(this,method,model,options);return xhr.then(function(){return this}).promise(xhr)}}),BCAPI.Models.Collection=Backbone.Collection.extend({initialize:function(){this._defaultLimit=BCAPI.Config.Pagination.limit,this._defaultSkip=BCAPI.Config.Pagination.skip,this._relationFetchPending=0},headers:function(){return this.model.prototype.headers.call()},urlRoot:function(){var modelEndpoint=this.model.prototype.endpoint();return this.model.prototype.urlRoot(modelEndpoint)},fetch:function(options){return options=options||{},options.headers=this.headers(),options.dataType="json",this._limit=options.limit,this._skip=options.skip,options.where&&(this._where=JSON.stringify(options.where)),this._order=options.order,Backbone.Collection.prototype.fetch.call(this,options)},url:function(){var urlWithParams=[this.urlRoot(),"?"];for(var key in this.server_api){var val=this.server_api[key].apply(this);void 0!==val&&(urlWithParams.push("&"),urlWithParams.push(key),urlWithParams.push("="),urlWithParams.push(val))}return urlWithParams[2]="",urlWithParams.join("")},server_api:{limit:function(){return this._limit||this._defaultLimit},skip:function(){return this._skip||this._defaultSkip},where:function(){return this._where},order:function(){return this._order}},parse:function(response){return response.items}})}(jQuery),function($){"use strict";BCAPI.Models.Category=BCAPI.Models.Model.extend({endpoint:function(){return"/api/v2/admin/sites/current/categories"}}),BCAPI.Models.CategoryCollection=BCAPI.Models.Collection.extend({model:BCAPI.Models.Category})}(jQuery),function($){"use strict";BCAPI.Models.Country=BCAPI.Models.Model.extend({endpoint:function(){return"/api/v2/admin/system/countries"}}),BCAPI.Models.CountryCollection=BCAPI.Models.Collection.extend({model:BCAPI.Models.Country})}(jQuery),function($){"use strict";function getParent(x){return"/"===x?BCAPI.Models.FileSystem.Root:new BCAPI.Models.FileSystem.Folder(x)}function mkFilePath(dirPath,name){return"/"===dirPath[dirPath.length-1]?dirPath+name:dirPath+"/"+name}function splitPath(path){var parent,name,index=path.lastIndexOf("/");return 0>index?name=path:(parent=path.substring(0,index),name=path.substring(index+1)),parent||(parent="/"),{parent:parent,name:name}}var FILE_REGEX=/^[^\&\%]+$/,Entity=BCAPI.Models.Model.extend({idAttribute:"path",constructor:function(a1,a2,a3){var attributes,options,initialProps={};if("string"==typeof a1){attributes=a2,options=a3;var path=$.trim(a1);if("/"===path)throw new Error('Cannot instantiate the "/" folder like this. Use BCAPI.Models.FileSystem.Root instead');var o=splitPath(path);initialProps.parent=getParent(o.parent),initialProps.name=o.name}else attributes=a1,options=a2;BCAPI.Models.Model.call(this,attributes,options),initialProps&&this.set(initialProps),this._refreshPath();var self=this;this.on("change:parent sync",function(){self._refreshPath()})},endpoint:function(){return"/api/v2/admin/sites/current/storage"},url:function(){return this.contentUrl()+"?meta"},contentUrl:function(){var p=this.get("path");return"/"===p[0]&&p.substring(1),this.urlRoot()+p},validate:function(attr){return attr.name&&"string"==typeof attr.name&&FILE_REGEX.test(attr.name)?attr.path&&"/"!==attr.path?void 0:"Invalid path for file: ["+attr.path+"]":"Invalid name for file: ["+attr.name+"]"},parse:function(result){var dateStr=result.lastModified;return result.lastModified=new Date(dateStr),result},toJSON:function(){return _.pick(this.attributes,"name")},_refreshPath:function(){this.set("path",mkFilePath(this.get("parent").get("path"),this.get("name")))}});BCAPI.Models.FileSystem={},BCAPI.Models.FileSystem.File=Entity.extend({upload:function(data){return $.ajax(this.contentUrl(),{contentType:"application/octet-stream",type:"PUT",data:data,processData:!1,headers:this.headers()})},uploadAndFetch:function(data){var self=this;return this.upload(data).then(function(){return self.fetch()})},download:function(){return $.ajax(this.contentUrl(),{type:"GET",headers:this.headers()})},initialize:function(){this.set("type","file")}}),BCAPI.Models.FileSystem.Folder=Entity.extend({file:function(name,attributes,options){var fullAttributes=_.extend({parent:this,name:name},attributes);return new BCAPI.Models.FileSystem.File(fullAttributes,options)},initialize:function(){this.set("type","folder")},create:function(){return $.ajax(this.contentUrl()+"?type=folder",{type:"PUT",processData:!1,headers:this.headers()})},parse:function(result){var items=Entity.prototype.parse.call(this,result),self=this,models=_.map(items.contents,function(obj){return obj.parent=self,"file"===obj.type?new BCAPI.Models.FileSystem.File(obj):"folder"===obj.type?new BCAPI.Models.FileSystem.Folder(obj):void 0});return items.contents=models,items}});var Root=BCAPI.Models.FileSystem.Folder.extend({constructor:function(){BCAPI.Models.Model.call(this),this.set({path:"/",name:"",parent:null})},validate:function(){},save:function(){throw new Error("Operation not supported.")},destroy:function(){throw new Error("Operation not supported.")}});BCAPI.Models.FileSystem.Root=new Root}(jQuery),function($){"use strict";BCAPI.Models.WebApp={},BCAPI.Models.WebApp.App=BCAPI.Models.Model.extend({idAttribute:"name",isNotNew:null,isNew:function(){return this.isNotNew?!1:!this.get("id")},endpoint:function(){return"/api/v2/admin/sites/current/webapps"},fetch:function(){return this.isNotNew=!0,Backbone.Model.prototype.fetch.apply(this,arguments)},destroy:function(){return this.isNotNew=!0,Backbone.Model.prototype.destroy.apply(this,arguments)}}),BCAPI.Models.WebApp.AppCollection=BCAPI.Models.Collection.extend({model:BCAPI.Models.WebApp.App,parse:function(response){return response=BCAPI.Models.Collection.prototype.parse.call(this,response)}})}(jQuery),function($){"use strict";BCAPI.Models.WebApp.Country=BCAPI.Models.Model.extend({constructor:function(webappName,attributes,options){BCAPI.Models.Model.call(this,attributes,options),this._webappName=webappName},endpoint:function(){var url=["/api/v2/admin/sites/current/webapps/"];return url.push(this._webappName),url.push("/countries"),url.join("")},toJSON:function(){return this.get("items")},save:function(options){return options=options||{},options.type="PUT",BCAPI.Models.Model.prototype.save.call(this,options)}})}(jQuery),function($){"use strict";var endpointGenerator=function(webappName){return"/api/v2/admin/sites/current/webapps/"+webappName+"/fields"};BCAPI.Models.WebApp.CustomField=BCAPI.Models.Model.extend({constructor:function(webappName,attributes,isNew,options){if(BCAPI.Models.Model.call(this,attributes,options),this._isNew=_.isBoolean(isNew)?isNew:!0,this._isNew&&(_.isUndefined(attributes)||_.isUndefined(attributes.id)))throw new Error("The id for the custom field must be specified.");var id=Number(attributes.id);if(!_.isNumber(id)||_.isNaN(id)||0>=id)throw new Error("The id for the custom field must be a positive number.");this._webappName=webappName,this.set({webapp:new BCAPI.Models.WebApp.App({name:webappName})})},endpoint:function(){return endpointGenerator(this._webappName)},toJSON:function(options){var result=BCAPI.Models.Model.prototype.toJSON.call(this,options);return delete result.webapp,result},isNew:function(){return this._isNew}}),BCAPI.Models.WebApp.CustomFieldCollection=BCAPI.Models.Collection.extend({constructor:function(webappName,attributes,options){BCAPI.Models.Collection.call(this,attributes,options),this._webappName=webappName},model:BCAPI.Models.WebApp.CustomField,urlRoot:function(){return this.model.prototype.urlRoot(endpointGenerator(this._webappName))},parse:function(response){response=BCAPI.Models.Collection.prototype.parse.call(this,response);var fields=[],self=this,Model=self.model;return _.each(response,function(field){fields.push(new Model(self._webappName,field,!1))}),fields}})}(jQuery),function($){"use strict";var endpointGenerator=function(webappName){var url=["/api/v2/admin/sites/current/webapps/"];return url.push(webappName),url.push("/items"),url.join("")};BCAPI.Models.WebApp.Item=BCAPI.Models.Model.extend({constructor:function(webappName,attributes,options){BCAPI.Models.Model.call(this,attributes,options),this._webappName=webappName,this.set({webapp:new BCAPI.Models.WebApp.App({name:webappName})})},endpoint:function(){return endpointGenerator(this._webappName)},toJSON:function(options){var result=BCAPI.Models.Model.prototype.toJSON.call(this,options);return delete result.webapp,result}}),BCAPI.Models.WebApp.ItemCollection=BCAPI.Models.Collection.extend({constructor:function(webappName,models,options){BCAPI.Models.Collection.call(this,models,options),this.webappName=webappName},model:BCAPI.Models.WebApp.Item,urlRoot:function(){return this.model.prototype.urlRoot(endpointGenerator(this.webappName))},parse:function(response){response=BCAPI.Models.Collection.prototype.parse.call(this,response);var items=[],self=this,Model=self.model;return _.each(response,function(item){items.push(new Model(self.webappName,item))}),items}})}(jQuery),function($){"use strict";BCAPI.Models.WebApp.ItemCategory=BCAPI.Models.Model.extend({defaults:{items:[]},constructor:function(webappName,webappItemId,attributes,options){BCAPI.Models.Model.call(this,attributes,options),this._webappName=webappName,this._webappItemId=webappItemId},endpoint:function(){var url=["/api/v2/admin/sites/current/webapps/"];return url.push(this._webappName),url.push("/items/"),url.push(this._webappItemId),url.push("/categories"),url.join("")},toJSON:function(){return this.get("items")},save:function(options){return options=options||{},options.type="PUT",BCAPI.Models.Model.prototype.save.call(this,options)}})}(jQuery),function($){function Component(){}function ComponentsFactory(){}BCAPI.Components=BCAPI.Components||{},BCAPI.Components.DataSources=BCAPI.Components.DataSources||{},BCAPI.Components.Validation=BCAPI.Components.Validation||{},BCAPI.Security=BCAPI.Security||{},BCAPI.Messaging=BCAPI.Messaging||{},BCAPI.Helper.MicroEvent.mixin(Component.prototype),Component.prototype.__BCON_EVT_PREFIX="onbc-",Component.prototype.__COMPTYPE__="BcApiComponent",Component.configure=function(opts){},Component.prototype.attached=function(){this._wireCustomEventsFromDom(),console.log(this.is+": attached to dom.")},Component.prototype.changeClass=function(newClass,domElem){if(domElem&&newClass){for(var classes=newClass.split(" ");domElem.classList.length>0;)domElem.classList.remove(domElem.classList[0]);for(var idx=0;idx<classes.length;idx++)try{domElem.classList.add(classes[idx])}catch(ex){ex=ex}}},Component.prototype.wireEvents=function(evts){if(void 0===evts||null===evts)throw new BCAPI.Components.Exceptions.WireEventException("You can not wire undefined / null events into component.");for(var evtName in evts){if(!evts[evtName])throw new BCAPI.Components.Exceptions.WireEventException("Event name "+evtName+" does not have callback specified.");this.on(evtName,evts[evtName])}},Component.prototype.isBcComponent=function(){return"BcApiComponent"===this.__COMPTYPE__},Component.prototype._wireDataSourceFromMarkup=function(){var dataSource=Polymer.dom(this).querySelector("*[rel='datasource']");dataSource&&dataSource.isDataSource&&dataSource.isDataSource()&&(this.dataSource=dataSource)},Component.prototype._wireCustomEventsFromDom=function(){for(var customEvents=this.customEvents||[],wiredEvents={},i=0;i<customEvents.length;i++){var evtName=this._getDomEvtName(customEvents[i]),attrName=this.__BCON_EVT_PREFIX+evtName;if(this.hasAttribute(attrName)){listener=this.getAttribute(attrName);for(var listenerParts=listener.split("."),ctx=window[listenerParts[0]],action=void 0,j=0;j<listenerParts.length;j++){var partName=listenerParts[j];action=(action||window)[partName],action||console.log(this.is+": Unable to wire "+listener+" to event "+evtName)}wiredEvents[evtName]=function(action,ctx){return function(evtData){action.call(ctx,evtData)}}(action,ctx)}}this.wireEvents(wiredEvents)},Component.prototype._getDomEvtName=function(evtName){var domEvtName=[];evtName=evtName||"";for(var i=0;i<evtName.length;i++){var currChar=evtName.charAt(i);currChar===currChar.toUpperCase()&&domEvtName.push("-"),domEvtName.push(currChar.toLowerCase())}return domEvtName.join("")},BCAPI.Components.Component=BCAPI.Components.Component||Component,ComponentsFactory.prototype.get=function(component){var baseComp=new Component;return $.extend(component,Component.prototype),component.__base=baseComp,component},BCAPI.Components.ComponentsFactory=BCAPI.Components.ComponentsFactory||new ComponentsFactory}($),function(){function WireEventException(msg){Object.defineProperty(this,"msg",{writable:!1,value:msg,enumerable:!0,configurable:!1}),Object.defineProperty(this,"errorType",{writable:!1,value:"BCAPI.Components.Exceptions.WireEventException",enumerable:!0,configurable:!0})}function NotImplementedException(msg){Object.defineProperty(this,"msg",{writable:!1,value:msg,enumerable:!0,configurable:!1}),Object.defineProperty(this,"errorType",{writable:!1,value:"BCAPI.Components.Exceptions.NotImplementedException",enumerable:!0,configurable:!0})}function BadArgumentException(msg,arg){Object.defineProperty(this,"msg",{writable:!1,value:msg,enumerable:!0,configurable:!1}),Object.defineProperty(this,"arg",{writable:!1,value:arg,enumerable:!0,configurable:!1}),Object.defineProperty(this,"errorType",{writable:!1,value:"BCAPI.Components.Exceptions.BadArgumentException",enumerable:!0,configurable:!0})}BCAPI.Components.Exceptions=BCAPI.Components.Exceptions||{},WireEventException.prototype=Object.create(Error.prototype),BCAPI.Components.Exceptions.WireEventException=WireEventException,NotImplementedException.prototype=Object.create(Error.prototype),BCAPI.Components.Exceptions.NotImplementedException=NotImplementedException,BadArgumentException.prototype=Object.create(Error.prototype),BCAPI.Components.Exceptions.BadArgumentException=BadArgumentException}(),function($){function DataSource(){}DataSource.prototype=BCAPI.Components.ComponentsFactory.get(DataSource.prototype),DataSource.prototype.isDataSource=function(){return!0},DataSource.prototype.attached=function(){this.__base.attached.apply(this);for(var parentNode=this.parentNode;parentNode&&!parentNode.supportsDataSource;)parentNode=parentNode.parentNode;parentNode&&parentNode.supportsDataSource&&(parentNode.dataSource=this),this.trigger("attached",{})},DataSource.prototype.fetch=function(opts){throw new BCAPI.Components.Exceptions.NotImplementedException("fetch is not implemented.")},DataSource.prototype.list=function(opts){throw new BCAPI.Components.Exceptions.NotImplementedException("list is not implemented.")},DataSource.prototype.create=function(opts){throw new BCAPI.Components.Exceptions.NotImplementedException("create is not implemented.")},DataSource.prototype.update=function(opts){throw new BCAPI.Components.Exceptions.NotImplementedException("update is not implemented.")},DataSource.prototype["delete"]=function(opts){throw new BCAPI.Components.Exceptions.NotImplementedException("delete is not implemented.")},BCAPI.Components.DataSources.DataSource=BCAPI.Components.DataSources.DataSource||DataSource}($),function(){function BcSecurityContext(accessToken,user,config){this.accessToken=accessToken,this.user=user,this.config=config}BcSecurityContext.prototype.renewAccess=function(){throw new BCAPI.Components.Exceptions.NotImplementedException("Not supported at the moment.")},BCAPI.Security.BcSecurityContext=BcSecurityContext}(),function(){function AccessToken(tokenData){tokenData=tokenData||{},this.userId=tokenData.userId,this.user=tokenData.user,this.token=tokenData.token,this.expiresIn=parseInt(tokenData.expiresIn,10),this.scopes=tokenData.scopes||[],this.createdAt=tokenData.createdAt}BCAPI.Security.AccessToken=BCAPI.Security.AccessToken||AccessToken}(),function(){function User(userInfo){this.userId=userInfo.userId||userInfo.id,this.firstName=userInfo.firstName,this.lastName=userInfo.lastName}BCAPI.Security.User=User}(),function($){BCAPI.Security.__bcSecurityCtxLoader=void 0,BCAPI.Security._securityCfg=void 0,BCAPI.Security._bcSecurityCtx=void 0,BCAPI.Security.configure=BCAPI.Security.configure||function(securityCfg){if(!securityCfg||"{}"===JSON.stringify(securityCfg))throw new BCAPI.Components.Exceptions.BadArgumentException("No securityCfg argument provided.","securityCfg");if(!securityCfg.siteUrl)throw new BCAPI.Components.Exceptions.BadArgumentException("securityCfg argument does not contain a site.","securityCfg.siteUrl");if(!securityCfg.accessToken)throw new BCAPI.Components.Exceptions.BadArgumentException("securityCfg argument does not contain an access token.","securityCfg.accessToken");BCAPI.Security._securityCfg=securityCfg},BCAPI.Security.getBcConfig=BCAPI.Security.getBcConfig||function(wnd){if(BCAPI.Security._securityCfg)return BCAPI.Security._securityCfg;wnd=wnd||window;var siteUrl=wnd.location.protocol+"//"+wnd.location.hostname,accessToken=$.cookie("access_token");return BCAPI.Security._securityCfg={siteUrl:siteUrl,accessToken:accessToken},BCAPI.Security._securityCfg},BCAPI.Security.getBcSecurity=BCAPI.Security.getBcSecurity||function(){if(BCAPI.Security.__bcSecurityCtxLoader)return BCAPI.Security.__bcSecurityCtxLoader;var securityCtxLoader=$.Deferred();if(BCAPI.Security._bcSecurityCtx)return setTimeout(function(){securityCtxLoader.resolve(BCAPI.Security._bcSecurityCtx)}),securityCtxLoader.promise();var meDataSource=document.createElement("bc-api"),securityCfg=BCAPI.Security.getBcConfig();meDataSource.configure({bcConfig:securityCfg,apiName:"users",apiVersion:"v3",resourceId:"me",fields:"id,firstName,lastName"});var response=meDataSource.list();return response.then(function(userData){var user=new BCAPI.Security.User(userData),accessToken=new BCAPI.Security.AccessToken({userId:user.userId,user:user,token:securityCfg.accessToken}),securityCtx=new BCAPI.Security.BcSecurityContext(accessToken,user,securityCfg);BCAPI.Security._bcSecurityCtx=securityCtx,securityCtxLoader.resolve(securityCtx),BCAPI.Security.__bcSecurityCtxLoader=void 0}),BCAPI.Security.__bcSecurityCtxLoader=securityCtxLoader.promise(),BCAPI.Security.__bcSecurityCtxLoader}}(jQuery);