<link rel="import" href="/lib/polymer/polymer.html">

<dom-module id="bc-datagrid">
    <template>
    <div class="panel panel-default">
        <content></content>
        <table class="table">
            <thead>
                <tr>
                <template is="dom-repeat" items="{{columns}}">
                    <td>{{item.name}}</td>
                </template>
                </tr>
            </thead>

            <tbody>
                <template is="dom-repeat" items="{{rows}}" as="itemRow">
                <tr>
                    <template is="dom-repeat" items="{{columns}}" as="col">
                    <td>{{_getItemValue(itemRow, col.id)}}</td>
                    </template>
                </tr>
                </template>
            </tbody>
        </table>
    </div>
    </template>

    <script type="text/javascript" src="/src/helper.js"></script>
    <script type="text/javascript" src="/src/webcomponents/components.js"></script>

    <script>
    var polymerObj = {
        is: "bc-datagrid",
        properties: {
            columns: Array,
            rows: Array,
            apiName: String,
            apiVersion: String
        },
        configure: function(opts) {
            opts = opts || {};

            this.columns = opts.columns || this.columns;
            this.rows = opts.rows || this._getRowsFromMarkup() || this.rows;
        },
        _getRowsFromMarkup: function() {
            var dataSource = Polymer.dom(this).querySelector("*[rel='datasource']"),
                self = this;

            dataSource.fetchData().done(function(data) {
                self.configure({rows: data.items});
            });
        },
        _getItemValue: function(item, itemProperty) {
            return item[itemProperty];
        }
    };

    polymerObj = BCAPI.Components.ComponentsFactory.get(polymerObj);

    Polymer(polymerObj);
    </script>
</dom-module>