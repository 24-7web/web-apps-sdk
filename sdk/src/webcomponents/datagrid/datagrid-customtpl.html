<link rel="import" href="/lib/polymer/polymer.html">

<dom-module id="bc-datagrid-customtpl">
    <script type="text/javascript" src="/src/helper.js"></script>
    <script type="text/javascript" src="/src/webcomponents/components.js"></script>

    <script>
        var webComponent = {
            "is": "bc-datagrid-customtpl",
            "properties": {
                item: {
                    type: Object,
                    notify: true,
                    observer: "changedItem"
                },
                col: {
                    type: Object/*,
                    observer: "changedCol"*/
                }
            },
            ready: function() {
                var content = document.createElement("div"),
                    self = this;
                content.innerHTML = this.col.template;

                this.domBind = document.createElement('template', 'dom-bind');
                this.domBind.item = this.item;
                this.domBind.col = this.col;
                this.domBind.getItemValue = function(item, property) {
                    return self.getItemValue(item, property);
                }

                this.domBind.content.appendChild(content);

                Polymer.dom(this).appendChild(this.domBind);
            },
            getItemValue: function(item, itemProperty) {
                var propertyParts = itemProperty.split(".");

                for (var idx = 0; idx < propertyParts.length; idx++) {
                    item = item[propertyParts[idx]];

                    if (!item) {
                        return;
                    }
                }

                return item;
            },
            changedItem: function(newItem) {
                if (!this.domBind) {
                    return;
                }

                this.domBind.item = newItem;
            },
            changedCol: function(newCol) {
                this.domBind.col = newCol;
            }
        };

        webComponent = BCAPI.Components.ComponentsFactory.get(webComponent);

        Polymer(webComponent);
    </script>
</dom-module>