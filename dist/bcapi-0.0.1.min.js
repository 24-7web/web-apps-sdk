!function($){var frameproxy={},count=0;frameproxy.functions=["jQuery.ajax","jQuery.get","jQuery.post","jQuery.getJSON"],frameproxy.global=window||global,frameproxy.ppath=function(root,expr,value){if("string"==typeof root&&(value=expr,expr=root,root=frameproxy.global,!frameproxy.global))throw"window not defined, specify frameproxy.global";var parts=expr.split("."),cur=root;if("undefined"==typeof value){for(var pi=0;pi<parts.length-1;pi++){if("object"!=typeof cur){cur=null;break}cur=cur[parts[pi]]}return cur?{obj:cur,value:cur[parts[parts.length-1]],name:parts[parts.length-1]}:{}}for(var pi=0;pi<parts.length&&"undefined"!=typeof cur&&null!==cur;pi++)cur[parts[pi]]=pi==parts.length-1?value:{},cur=cur[parts[pi]]},frameproxy.stripFunctions=function(obj){var res=obj;if("object"==typeof obj){if(obj instanceof Array){res=[];for(var i=obj.length;i>=0;i--)"function"==typeof obj[i]?res[i]=null:"object"==typeof obj[i]&&(res[i]=frameproxy.stripFunctions(obj[i]))}else res={};for(var prop in obj)"function"!=typeof obj[prop]&&(res[prop]="object"==typeof obj[prop]?frameproxy.stripFunctions(obj[prop]):obj[prop])}return res},frameproxy.message={pack:function(msg){return msg},unpack:function(msg){return msg}},frameproxy.ProxyClient=function(target,password){if(!window.postMessage)throw"window.postMessage not supported on this browser";if("undefined"==typeof jQuery)throw"jQuery is required";this.password=password,this.deferreds={},this.callbacks={},this.proxyWindow=null,"object"==typeof target&&"function"==typeof target.postMessage?(this.proxyWindow=target,function(proxy){jQuery(function(){jQuery(proxy).trigger("ready")})}(this)):(this.iframe=document.createElement("iframe"),this.iframe.src=target,this.iframe.style.display="none",function(iframe,proxy){jQuery(function(){jQuery(iframe).load(function(){proxy.proxyWindow=iframe.contentWindow,jQuery(proxy).trigger("ready")}),jQuery("body").append(iframe)})}(this.iframe,this)),function(proxy){var proxyMessage=function(e){if(e.source===proxy.proxyWindow){var id,deferred;try{var data=JSON.parse(e.data);id=data.id,data.id&&(deferred=proxy.deferreds[data.id])&&(data.error?deferred.reject.apply(deferred,data.args):("object"==typeof data.args[0]&&deferred.done(data.args[0]),"undefined"!=typeof data.result?deferred.resolve.apply(deferred,[data.result]):deferred.resolve.apply(deferred,data.args)))}catch(err){deferred.isRejected()||deferred.reject(err)}finally{id&&(delete proxy.deferreds[id],jQuery.isEmptyObject(proxy.deferreds)&&$(document).trigger("ajaxStop"))}}};window.addEventListener?window.addEventListener("message",function(e){proxyMessage(e)}):window.attachEvent&&window.attachEvent("onmessage",function(e){proxyMessage(e)})}(this)},frameproxy.ProxyClient.prototype.remote=function(expr,args){var url="";if("string"==typeof args[0]?url=args[0]:"object"==typeof args[0]&&"string"==typeof args[0].url&&(url=args[0].url),url&&(!url.match(/^https?:/)||0==url.indexOf(location.protocol+"//"+location.host))){var obj=frameproxy.ppath(window,expr+"NoProxy");return obj.value.apply(obj.obj,args)}count++;var id="_"+count,deferred=this.deferreds[id]=jQuery.Deferred();$.each(args,function(i,arg){"function"==typeof arg?deferred.done(arg):"object"==typeof arg&&null!=arg&&(arg.error&&deferred.fail(arg.error),arg.success&&deferred.done(arg.success))});var msg=frameproxy.message.pack({id:id,expr:expr,args:args});this.password&&(msg.password=this.password);var self=this;return this.ready(function(){self.proxyWindow.postMessage(JSON.stringify(msg),"*")}),deferred.promise()},frameproxy.ProxyClient.prototype.ready=function(handler){return handler?(this.proxyWindow?handler.apply(this):jQuery(this).bind("ready",handler),this):null},frameproxy.ProxyClient.prototype.wrapAll=function(){jQuery.currentFrameProxy=this;var args=Array.prototype.slice.apply(arguments);return args.push.apply(args,frameproxy.functions),this.wrap.apply(this,args)},frameproxy.ProxyClient.prototype.wrap=function(replace){for(var makeRemote=function(proxy,expr){return function(){return proxy.remote(expr,Array.prototype.slice.apply(arguments))}},repl=replace===!0,i=0;i<arguments.length;i++){var expr=arguments[i];if("string"==typeof expr){var rmt=makeRemote(this,expr);if(frameproxy.ppath(this,expr,rmt),repl){var e=frameproxy.ppath(expr);e.obj&&"undefined"==typeof e.obj[e.name+"NoProxy"]&&(e.obj[e.name+"NoProxy"]=e.obj[e.name],e.obj[e.name]=rmt)}}}return this},frameproxy.ProxyServer=function(options){if(!window.postMessage)throw"window.postMessage not supported on this browser";if("undefined"==typeof jQuery)throw"jQuery is required";this.options=jQuery.extend(!0,{},frameproxy.ProxyServer.options,options)},frameproxy.ProxyServer.options={domain:"*",uri:"*",password:null,expressions:Array.prototype.slice.apply(frameproxy.functions)},frameproxy.ProxyServer.prototype.listen=function(){var stringIsAllowed=function(str,filters){if(!filters)return!0;for(var f=filters instanceof Array?filters:[filters],i=0;i<f.length;i++){var filter=f[i];if("*"===filter)return!0;if(filter instanceof RegExp){if(filter.test(str))return!0}else if("function"==typeof filter){if(filter(str))return!0}else if(filter===str)return!0}return!1};return function(options){var proxyMessage=function(e){var id=-1;try{var data=JSON.parse(e.data),sourceWindow=e.source;if(options.password&&e.data.password!==options.password)throw"request rejected: invalid password";if(!stringIsAllowed(e.domain,options.domain))throw'request rejected: invalid domain "'+e.domain+'"';if(!stringIsAllowed(e.uri,options.uri))throw'request rejected: invalid domain "'+e.domain+'"';if("undefined"==typeof data.id)throw"no id specified";if(!data.expr)throw"no expr specified";var id=data.id;if(!stringIsAllowed(data.expr,options.expressions))throw'request rejected: invalid expr "'+data.expr+'"';var result,p=frameproxy.ppath(data.expr);if(p.obj&&(result="function"==typeof p.value?p.value.apply(p.obj,data.args):p.value),result&&"function"==typeof result.then){var done=function(id){return function(){var msg=frameproxy.message.pack({ok:!0,id:id,args:Array.prototype.slice.apply(arguments)});sourceWindow.postMessage(JSON.stringify(msg),"*")}}(id),fail=function(id){return function(){var msg=frameproxy.message.pack({error:"deferred failed",id:id,args:Array.prototype.slice.apply(arguments)});sourceWindow.postMessage(JSON.stringify(msg),"*")}}(id);result.then(done,fail)}else{var msg=frameproxy.message.pack({ok:!0,id:id,result:"undefined"==typeof result?null:result});sourceWindow.postMessage(msg,"*")}}catch(err){var msg=frameproxy.message.pack({id:id,error:err});e.source.postMessage(msg,"*")}};window.addEventListener?window.addEventListener("message",function(e){proxyMessage(e)}):window.attachEvent&&window.attachEvent("onmessage",function(e){proxyMessage(e)})}(this.options),$(this).trigger("ready"),this},frameproxy.ProxyServer.prototype.ready=function(handler){return $(this).bind("ready",handler),this},"undefined"!=typeof window?window.frameproxy=frameproxy:"undefined"!=typeof exports&&(exports.frameproxy=frameproxy)}(jQuery),function($){"use strict";$.ajaxSetup({cache:!1}),window.BCAPI={}}(jQuery),function($){BCAPI.Helper={},BCAPI.Helper.Site={},BCAPI.Helper.Site.getAccessToken=function(){if(!$.cookie)return $.error("Include jQuery.cookie or override BCAPI.Helper.Site.getAccessToken with your own implementation.");var location=BCAPI.Helper.Http.getCurrentLocation(),parameters=BCAPI.Helper.Http.getHashFragments(location),paramAccessToken=parameters.access_token;if(paramAccessToken){var expireTimeSeconds=parameters.expires_in;expireTimeSeconds||(expireTimeSeconds=14400);var expireDate=new Date(Date.now()+1e3*expireTimeSeconds);return $.cookie("access_token",paramAccessToken,{expires:expireDate}),paramAccessToken}var tokenCookie=$.cookie("access_token");return tokenCookie?tokenCookie:$.error("No access_token passed in hash fragment.")},BCAPI.Helper.Site.getRootUrl=function(wnd){wnd=wnd||window;var url=[wnd.location.protocol,"//",wnd.location.hostname].join("");return url},BCAPI.Helper.Site.getSiteId=function(){return"current"},BCAPI.Helper.Http={},BCAPI.Helper.Http.getDecodedParameters=function(paramString){var i,p,params=paramString.split("&"),decodedParams={};if(""===params)return{};for(i=0;i<params.length;i+=1)p=params[i].split("="),2===p.length&&(decodedParams[p[0]]=decodeURIComponent(p[1].replace(/\+/g," ")));return decodedParams},BCAPI.Helper.Http.getQueryParameters=function(location){return void 0==typeof location.search||0==location.search.length?{}:BCAPI.Helper.Http.getDecodedParameters(location.search.substr(1))},BCAPI.Helper.Http.getHashFragments=function(location){return void 0==typeof location.hash||0==location.hash.length?{}:BCAPI.Helper.Http.getDecodedParameters(location.hash.substr(1))},BCAPI.Helper.Http.getCurrentLocation=function(){return window.location}}(jQuery),function($){BCAPI.Helper.CORS={},BCAPI.Helper.CORS.CorsBoot=function(jQuery,rootUrl){this._jQuery=jQuery,this._rootUrl=rootUrl},BCAPI.Helper.CORS.CorsBoot.prototype._getIEVersion=function(){var rv=-1;if("Microsoft Internet Explorer"==navigator.appName){var ua=navigator.userAgent,re=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");null!=re.exec(ua)&&(rv=parseFloat(RegExp.$1))}return rv},BCAPI.Helper.CORS.CorsBoot.prototype.boot=function(){var ieVersion=this._getIEVersion();if(!(-1==ieVersion||ieVersion>=10)){this._jQuery.ajaxSetup({cache:!1});var proxy=new frameproxy.ProxyClient(this._rootUrl+"/AdminConsoleXT/frameproxy.htm");proxy.wrapAll(!0),this._jQuery.currentFrameProxy=proxy}};var corsBoot=new BCAPI.Helper.CORS.CorsBoot($,BCAPI.Helper.Site.getRootUrl());corsBoot.boot()}(jQuery),function(){var Config={};Config.Pagination={limit:10,skip:0},Config.MAX_DATE="9999-01-01",BCAPI.Config=Config}(jQuery),function(){BCAPI.Models={},BCAPI.Models.Model=Backbone.Model.extend({endpoint:function(){throw new Error("You must provide an endpoint for your model. E.g: /api/v2/persons")},headers:function(){return{Authorization:BCAPI.Helper.Site.getAccessToken()}},urlRoot:function(){var url=BCAPI.Helper.Site.getRootUrl(),endpoint=this.endpoint();return"/"!==endpoint.charAt(0)&&(endpoint="/"+endpoint),url+endpoint},save:function(options){return options=options||{},options.dataType="text",Backbone.Model.prototype.save.call(this,this.attributes,options)},destroy:function(options){return options||(options={}),options.dataType="text",Backbone.Model.prototype.destroy.call(this,options)},sync:function(method,model,options){var customHeaders=this.headers();options.headers=options.headers||{};for(var headerKey in customHeaders)options.headers[headerKey]=customHeaders[headerKey];var xhr=Backbone.Model.prototype.sync.call(this,method,model,options);return xhr.then(function(){return this}).promise(xhr)}}),BCAPI.Models.Collection=Backbone.Collection.extend({initialize:function(){this._defaultLimit=BCAPI.Config.Pagination.limit,this._defaultSkip=BCAPI.Config.Pagination.skip,this._relationFetchPending=0},fetch:function(options){return options=options||{},options.headers=(new this.model).headers(),options.dataType="json",this._limit=options.limit,this._skip=options.skip,options.where&&(this._where=JSON.stringify(options.where)),this._order=options.order,Backbone.Collection.prototype.fetch.call(this,options)},url:function(model){model=model||new this.model;var urlWithParams=[model.urlRoot(),"?"];for(var key in this.server_api){var val=this.server_api[key].apply(this);void 0!==val&&(urlWithParams.push("&"),urlWithParams.push(key),urlWithParams.push("="),urlWithParams.push(val))}return urlWithParams[2]="",urlWithParams.join("")},server_api:{limit:function(){return this._limit||this._defaultLimit},skip:function(){return this._skip||this._defaultSkip},where:function(){return this._where},order:function(){return this._order}},parse:function(response){return response.items}})}(jQuery),function(){"use strict";BCAPI.Models.Category=BCAPI.Models.Model.extend({endpoint:function(){return"/api/v2/admin/sites/current/categories"}}),BCAPI.Models.CategoryCollection=BCAPI.Models.Collection.extend({model:BCAPI.Models.Category})}(jQuery),function(){"use strict";BCAPI.Models.Country=BCAPI.Models.Model.extend({endpoint:function(){return"/api/v2/admin/system/countries"}}),BCAPI.Models.CountryCollection=BCAPI.Models.Collection.extend({model:BCAPI.Models.Country})}(jQuery),function($){"use strict";function getParent(x){return"/"==x?BCAPI.Models.FileSystem.Root:new BCAPI.Models.FileSystem.Folder(x)}function mkFilePath(dirPath,name){return"/"==dirPath[dirPath.length-1]?dirPath+name:dirPath+"/"+name}function splitPath(path){var parent,name,index=path.lastIndexOf("/");return 0>index?name=path:(parent=path.substring(0,index),name=path.substring(index+1)),parent||(parent="/"),{parent:parent,name:name}}var FILE_REGEX=/^[^\&\%]+$/,Entity=BCAPI.Models.Model.extend({idAttribute:"path",constructor:function(a1,a2,a3){var attributes,options,initialProps={};if("string"==typeof a1){attributes=a2,options=a3;var path=$.trim(a1);if("/"==path)throw new Error('Cannot instantiate the "/" folder like this. Use BCAPI.Models.FileSystem.Root instead');var o=splitPath(path);initialProps.parent=getParent(o.parent),initialProps.name=o.name}else attributes=a1,options=a2;BCAPI.Models.Model.call(this,attributes,options),initialProps&&this.set(initialProps),this._refreshPath();var model=this;this.on("change:parent sync",function(){model._refreshPath()})},endpoint:function(){return"/api/v2/admin/sites/current/storage"},url:function(){return this.contentUrl()+"?meta"},contentUrl:function(){var p=this.get("path");return"/"==p[0]&&p.substring(1),this.urlRoot()+p},validate:function(attr){return attr.name&&"string"==typeof attr.name&&FILE_REGEX.test(attr.name)?attr.path&&"/"!==attr.path?void 0:"Invalid path for file: ["+attr.path+"]":"Invalid name for file: ["+attr.name+"]"},parse:function(result){var dateStr=result.lastModified;return result.lastModified=new Date(dateStr),result},toJSON:function(){return _.pick(this.attributes,"name")},_refreshPath:function(){this.set("path",mkFilePath(this.get("parent").get("path"),this.get("name")))}});BCAPI.Models.FileSystem={},BCAPI.Models.FileSystem.File=Entity.extend({upload:function(data){return $.ajax(this.contentUrl(),{contentType:"application/octet-stream",type:"PUT",data:data,processData:!1,headers:this.headers()})},uploadAndFetch:function(data){var self=this;return this.upload(data).then(function(){return self.fetch()})},download:function(){return $.ajax(this.contentUrl(),{type:"GET",headers:this.headers()})},initialize:function(){this.set("type","file")}}),BCAPI.Models.FileSystem.Folder=Entity.extend({file:function(name,attributes,options){var fullAttributes=_.extend({parent:this,name:name},attributes);return new BCAPI.Models.FileSystem.File(fullAttributes,options)},initialize:function(){this.set("type","folder")},create:function(){return $.ajax(this.contentUrl()+"?type=folder",{type:"PUT",processData:!1,headers:this.headers()})},parse:function(result){var items=Entity.prototype.parse.call(this,result),parent=this,models=_.map(items.contents,function(obj){return obj.parent=parent,"file"===obj.type?new BCAPI.Models.FileSystem.File(obj):"folder"===obj.type?new BCAPI.Models.FileSystem.Folder(obj):void 0});return items.contents=models,items}});var Root=BCAPI.Models.FileSystem.Folder.extend({constructor:function(){BCAPI.Models.Model.call(this),this.set({path:"/",name:"",parent:null})},validate:function(){},save:function(){throw new Error("Operation not supported")},destroy:function(){throw new Error("Operation not supported")}});BCAPI.Models.FileSystem.Root=new Root}(jQuery),function(){"use strict";BCAPI.Models.WebApp={},BCAPI.Models.WebApp.App=BCAPI.Models.Model.extend({idAttribute:"name",isNotNew:null,isNew:function(){return this.isNotNew?!1:!this.get("id")},endpoint:function(){return"/api/v2/admin/sites/current/webapps"},fetch:function(){return this.isNotNew=!0,Backbone.Model.prototype.fetch.apply(this,arguments)},destroy:function(){return this.isNotNew=!0,Backbone.Model.prototype.destroy.apply(this,arguments)}}),BCAPI.Models.WebApp.AppCollection=BCAPI.Models.Collection.extend({model:BCAPI.Models.WebApp.App,parse:function(response){var webapps=[],self=this;return response=BCAPI.Models.Collection.prototype.parse.call(this,response),_.each(response,function(webapp){webapps.push(self.model(webapp))}),webapps}})}(jQuery),function(){"use strict";BCAPI.Models.WebApp.Country=BCAPI.Models.Model.extend({constructor:function(webappName,attributes,options){BCAPI.Models.Model.call(this,attributes,options),this._webappName=webappName},endpoint:function(){var url=["/api/v2/admin/sites/current/webapps/"];return url.push(this._webappName),url.push("/countries"),url.join("")},toJSON:function(){return this.get("items")},save:function(options){return options=options||{},options.type="PUT",BCAPI.Models.Model.prototype.save.call(this,options)}})}(jQuery),function(){"use strict";BCAPI.Models.WebApp.CustomField=BCAPI.Models.Model.extend({constructor:function(webappName,attributes,options){BCAPI.Models.Model.call(this,attributes,options),this._webappName=webappName,this.set({webapp:new BCAPI.Models.WebApp.App({name:webappName})})},endpoint:function(){return"/api/v2/admin/sites/current/webapps/"+this._webappName+"/fields"}}),BCAPI.Models.WebApp.CustomFieldCollection=BCAPI.Models.Collection.extend({constructor:function(webappName,attributes,options){BCAPI.Models.Collection.call(this,attributes,options),this.webappName=webappName},model:BCAPI.Models.WebApp.CustomField,url:function(){var model=new this.model(this.webappName);return BCAPI.Models.Collection.prototype.url.call(this,model)},parse:function(response){response=BCAPI.Models.Collection.prototype.parse.call(this,response);var fields=[],self=this;return _.each(response,function(field){fields.push(new self.model(self.webappName,field))}),fields}})}(jQuery),function(){"use strict";BCAPI.Models.WebApp.Item=BCAPI.Models.Model.extend({constructor:function(webappName,attributes,options){BCAPI.Models.Model.call(this,attributes,options),this._webappName=webappName,this.set({webapp:new BCAPI.Models.WebApp.App({name:webappName})})},endpoint:function(){var url=["/api/v2/admin/sites/current/webapps/"];return url.push(this._webappName),url.push("/items"),url.join("")}}),BCAPI.Models.WebApp.ItemCollection=BCAPI.Models.Collection.extend({constructor:function(webappName,models,options){BCAPI.Models.Collection.call(this,models,options),this.webappName=webappName},model:BCAPI.Models.WebApp.Item,url:function(){var model=new this.model(this.webappName);return BCAPI.Models.Collection.prototype.url.call(this,model)},parse:function(response){response=BCAPI.Models.Collection.prototype.parse.call(this,response);var items=[],self=this;return _.each(response,function(item){items.push(new self.model(self.webappName,item))}),items}})}(jQuery),function(){"use strict";BCAPI.Models.WebApp.ItemCategory=BCAPI.Models.Model.extend({defaults:{items:[]},constructor:function(webappName,webappItemId,attributes,options){BCAPI.Models.Model.call(this,attributes,options),this._webappName=webappName,this._webappItemId=webappItemId},endpoint:function(){var url=["/api/v2/admin/sites/current/webapps/"];return url.push(this._webappName),url.push("/items/"),url.push(this._webappItemId),url.push("/categories"),url.join("")},toJSON:function(){return this.get("items")},save:function(options){return options=options||{},options.type="PUT",BCAPI.Models.Model.prototype.save.call(this,options)}})}(jQuery);